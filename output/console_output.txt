Started by user Songpanon
Obtained Jenkinsfile from git https://github.com/Flukely/DevOps-Engineer-Term-Project.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/my-nodejs-app
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
Cloning the remote Git repository
Cloning repository https://github.com/Flukely/DevOps-Engineer-Term-Project.git
 > git init /var/jenkins_home/workspace/my-nodejs-app # timeout=10
Fetching upstream changes from https://github.com/Flukely/DevOps-Engineer-Term-Project.git
 > git --version # timeout=10
 > git --version # 'git version 2.39.5'
 > git fetch --tags --force --progress -- https://github.com/Flukely/DevOps-Engineer-Term-Project.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.com/Flukely/DevOps-Engineer-Term-Project.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision fda140eb05c2ac5d2a9fcbe1a8cfef05539e24d7 (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f fda140eb05c2ac5d2a9fcbe1a8cfef05539e24d7 # timeout=10
Commit message: "edit"
 > git rev-list --no-walk 31f5e3478c5fa9f6dece506e0b099e792a1d78da # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $NETLIFY_AUTH
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Build)
[Pipeline] getContext
[Pipeline] isUnix
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ docker inspect -f . node:18-alpine
.
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] withDockerContainer
Jenkins seems to be running inside container 0d73aadd6b25c0a918ca351a401b9623cf382b8d055f0f5474a1116123103a15
but /var/jenkins_home/workspace/my-nodejs-app could not be found among []
but /var/jenkins_home/workspace/my-nodejs-app@tmp could not be found among []
$ docker run -t -d -u 1000:1000 -w /var/jenkins_home/workspace/my-nodejs-app -v /var/jenkins_home/workspace/my-nodejs-app:/var/jenkins_home/workspace/my-nodejs-app:rw,z -v /var/jenkins_home/workspace/my-nodejs-app@tmp:/var/jenkins_home/workspace/my-nodejs-app@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** node:18-alpine cat
$ docker top 5b469e34025a793c63db12349f71f680a52a275f7b116dda8285373549b62209 -eo pid,comm
[Pipeline] {
[Pipeline] sh
+ echo '-----------------Building the project-----------------'
-----------------Building the project-----------------
+ node --version
v18.20.8
+ npm --version
10.8.2
+ npm ci
npm warn deprecated superagent@8.1.2: Please upgrade to v9.0.0+ as we have fixed a public vulnerability with formidable dependency. Note that v9.0.0+ requires Node.js v14.18.0+. See https://github.com/ladjs/superagent/pull/1800 for insight. This project is supported and maintained by the team at Forward Email @ https://forwardemail.net

added 434 packages, and audited 435 packages in 7s

66 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
+ npm run build

> my-nodejs-app@1.0.0 build
> npm install && mkdir -p build && cp -r public/* build/


up to date, audited 435 packages in 2s

66 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
+ ls -la build/
total 820
drwxr-xr-x    2 node     node          4096 Mar 31 09:38 .
drwxr-xr-x    8 node     node          4096 Mar 31 09:38 ..
-rw-r--r--    1 node     node        824784 Mar 31 09:38 Profile.png
-rw-r--r--    1 node     node          3397 Mar 31 09:38 index.html
[Pipeline] }
$ docker stop --time=1 5b469e34025a793c63db12349f71f680a52a275f7b116dda8285373549b62209
$ docker rm -f --volumes 5b469e34025a793c63db12349f71f680a52a275f7b116dda8285373549b62209
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test)
[Pipeline] getContext
[Pipeline] isUnix
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ docker inspect -f . node:18-alpine
.
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] withDockerContainer
Jenkins seems to be running inside container 0d73aadd6b25c0a918ca351a401b9623cf382b8d055f0f5474a1116123103a15
but /var/jenkins_home/workspace/my-nodejs-app could not be found among []
but /var/jenkins_home/workspace/my-nodejs-app@tmp could not be found among []
$ docker run -t -d -u 1000:1000 -w /var/jenkins_home/workspace/my-nodejs-app -v /var/jenkins_home/workspace/my-nodejs-app:/var/jenkins_home/workspace/my-nodejs-app:rw,z -v /var/jenkins_home/workspace/my-nodejs-app@tmp:/var/jenkins_home/workspace/my-nodejs-app@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** node:18-alpine cat
$ docker top 7db9e1f73ae1ba64c09adc2a14aa74d751506cf5380b7561c1b5a43c1c89d84b -eo pid,comm
[Pipeline] {
[Pipeline] sh
+ echo '-------------------Running Tests-----------------------'
-------------------Running Tests-----------------------
+ npm test

> my-nodejs-app@1.0.0 test
> jest --ci --forceExit

  console.log
    Server running on http://localhost:3000

      at Server.log (server.js:13:11)

PASS __tests__/app.test.js
  GET /api/hello
    ✓ should return hello message (42 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        0.611 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
[Pipeline] }
$ docker stop --time=1 7db9e1f73ae1ba64c09adc2a14aa74d751506cf5380b7561c1b5a43c1c89d84b
$ docker rm -f --volumes 7db9e1f73ae1ba64c09adc2a14aa74d751506cf5380b7561c1b5a43c1c89d84b
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] getContext
[Pipeline] isUnix
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ docker inspect -f . node:18-alpine
.
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] withDockerContainer
Jenkins seems to be running inside container 0d73aadd6b25c0a918ca351a401b9623cf382b8d055f0f5474a1116123103a15
but /var/jenkins_home/workspace/my-nodejs-app could not be found among []
but /var/jenkins_home/workspace/my-nodejs-app@tmp could not be found among []
$ docker run -t -d -u 1000:1000 -w /var/jenkins_home/workspace/my-nodejs-app -v /var/jenkins_home/workspace/my-nodejs-app:/var/jenkins_home/workspace/my-nodejs-app:rw,z -v /var/jenkins_home/workspace/my-nodejs-app@tmp:/var/jenkins_home/workspace/my-nodejs-app@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** node:18-alpine cat
$ docker top 331822d5d602837c391645f2f2a95ea03710a512c0e6635e3148dcfb8c139666 -eo pid,comm
[Pipeline] {
[Pipeline] sh
+ echo '------------------Installing netlify-cli----------------------'
------------------Installing netlify-cli----------------------
+ npm install netlify-cli
npm warn deprecated rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
npm warn deprecated npmlog@5.0.1: This package is no longer supported.
npm warn deprecated gauge@3.0.2: This package is no longer supported.
npm warn deprecated are-we-there-yet@2.0.0: This package is no longer supported.
npm warn deprecated glob@8.1.0: Glob versions prior to v9 are no longer supported

added 1596 packages, and audited 2034 packages in 36s

284 packages are looking for funding
  run `npm fund` for details

8 moderate severity vulnerabilities

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
+ echo '------------------Deploying to Netlify----------------------'
------------------Deploying to Netlify----------------------
+ npx netlify --version
netlify-cli/19.1.4 linux-x64 node-v18.20.8
+ npx netlify deploy '--dir=build' --prod '--site=f389d8a8-e9f3-4555-a70d-d0b5677d72b9' '--auth=****'
Deploy path: /var/jenkins_home/workspace/my-nodejs-app/build
Deploying to main site URL...
[33m⠋[39m Uploading blobs to deploy store...

​
Netlify Build                                                 
────────────────────────────────────────────────────────────────
​
❯ Version
  @netlify/build 30.0.6
​
❯ Flags
  auth: ****
  deployId: 67ea62c2626da23ee446898e
  dir: build
  open: false
  prod: true
  prodIfUnlocked: false
  site: f389d8a8-e9f3-4555-a70d-d0b5677d72b9
  skipFunctionsCache: false
​
❯ Current directory
  /var/jenkins_home/workspace/my-nodejs-app
​
❯ Config file
  No config file was defined: using default values.
​
❯ Context
  dev
[33m⠙[39m Finished uploading blobs to deploy store
[33m⠋[39m Hashing files...
[33m⠋[39m Looking for a functions cache...
[33m⠙[39m No cached functions were found
[33m⠙[39m Finished hashing 
[33m⠋[39m CDN diffing files...
[33m⠙[39m CDN requesting 1 files
[33m⠋[39m Uploading 1 files
[33m⠙[39m Finished uploading 1 assets
[33m⠋[39m Waiting for deploy to go live...
[33m⠙[39m Deploy is live!

Build logs:         https://app.netlify.com/sites/my-nodejs-app-65315062/deploys/67ea62c2626da23ee446898e
Function logs:      https://app.netlify.com/sites/my-nodejs-app-65315062/logs/functions
Edge function Logs: https://app.netlify.com/sites/my-nodejs-app-65315062/logs/edge-functions
Unique deploy URL:  https://67ea62c2626da23ee446898e--my-nodejs-app-65315062.netlify.app
Website URL:        https://my-nodejs-app-65315062.netlify.app
[Pipeline] }
$ docker stop --time=1 331822d5d602837c391645f2f2a95ea03710a512c0e6635e3148dcfb8c139666
$ docker rm -f --volumes 331822d5d602837c391645f2f2a95ea03710a512c0e6635e3148dcfb8c139666
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Post deploy)
Stage "Post deploy" skipped due to when conditional
[Pipeline] getContext
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
Cleaning up workspace...
[Pipeline] cleanWs
[WS-CLEANUP] Deleting project workspace...
[WS-CLEANUP] Deferred wipeout is used...
[WS-CLEANUP] done
[Pipeline] echo
Pipeline succeeded!
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
